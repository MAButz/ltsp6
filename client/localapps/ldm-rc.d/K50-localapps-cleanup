if boolean_is_true "$LOCAL_APPS"; then
    # Clean up cups config
    if [ -r /etc/cups/client.conf ]; then
        rm -f /etc/cups/client.conf
    fi

    # Unmount extra mounts
    if [ -n "$LOCAL_APPS_EXTRAMOUNTS" ]; then
        oldifs="${IFS-not set}"
        IFS=','
        for extradir in $LOCAL_APPS_EXTRAMOUNTS; do
            fusermount -uqz "$extradir"
        done
        test "$oldifs" = "not set" && unset IFS || IFS="$oldifs"
    fi

    # Unmount sshfs home and remove the mount dir
    if [ -n "$SSHFS_HOME" ] && [ -d "$LDM_HOME" ]; then
        # Ensure that no user processes are accessing $LDM_HOME
        if pkill -u "$LDM_USERNAME"; then
            sleep 1
        fi
        fusermount -uqz "$LDM_HOME"
        rmdir "$LDM_HOME"
    fi

    # Copy back passwd and group
    for i in passwd group; do
        if [ -e "$LOCALAPPS_CACHE/$i" ]; then
            cp "$LOCALAPPS_CACHE/$i" /etc/
        fi
    done
fi

# Clean up remote apps tmpdir
if boolean_is_true "$REMOTE_APPS" && [ -d "$REMOTE_APPS_TMPDIR" ] ; then
    fusermount -uqz "$REMOTE_APPS_TMPDIR"
    rmdir "$REMOTE_APPS_TMPDIR"
    if [ -w /usr/lib/mime/packages/ltsp ]; then
        rm -f /usr/lib/mime/packages/ltsp
        update-mime
    fi
fi
